#SET{mots,#ARRAY}
<BOUCLE_mots(DATA){source tableau, #LISTE{themes,organisations}}>
[(#ENV{#VALEUR}|oui)#SET{mots,#GET{mots}|push{#ENV{#VALEUR}}]
</BOUCLE_mots>
[(#REM) Les langues des tutos]
#SET{langues_def,#ARRAY}
<BOUCLE_tutos_langues_def(TUTOS) {fusion lang}>
	#SET{langues_def, #GET{langues_def}|array_merge{#ARRAY{#COMPTEUR_BOUCLE,#LANG}}}
</BOUCLE_tutos_langues_def>

<div class="formulaire_spip formulaire_recherche_tutos" id="formulaire_recherche_tutos">
	<form action="[(#ENV{action})]#formulaire_recherche_tutos" method="get">
		<div>
			<div class="editer-groupe">
				[(#ENV{action}|form_hidden)]

				[(#SAISIE{input,recherche,label=<:spip:info_rechercher:>})]

				[(#SAISIE{checkbox,recherche_avancee,
					label=<:tutotheque:fieldset_recherche_avancee_label:>,
					data=#ARRAY{oui,<:tutotheque:fieldset_recherche_avancee_label:>}
				})]

				<INCLURE{
					fond=formulaires/inc-recherche_tutos_criteres,
					env,
					langues_def=#GET{langues_def},
					ajax=recherche_criteres}/>

				<p class="boutons">
					<input type="submit" class="submit" value="<:info_rechercher:>" />
				</p>
			</div>
			[(#REM) tutos trouv√©s ]
			<INCLURE{fond=inclure/tutos,env,langues_def=#GET{langues_def},ajax}/>
		</div>
	</form>
</div>

<script type="text/javascript">
	$( document ).ready(function() {
		$('.checkbox_recherche_avancee').hide();
		var texte = $('.editer_recherche_avancee .choix ').text().trim();

		var texteOuvert = '<:tutotheque:fieldset_recherche_simple_label:>';
		if ($('.editer_recherche_avancee input').is(':checked')) {
			var remplace  = texte.replace(texte, texteOuvert);
			$('.editer_recherche_avancee .choix label').html(remplace);
		}

		var champRechercheAvancee  = document.querySelector('.editer_recherche_avancee input');
		champRechercheAvancee.addEventListener('click', function(event) {

		var criteres = [(#ENV{_criteres}|json_encode)]
		var args = {
			_criteres: criteres,
		};
		var langue =  $('#champ_langue').val();
		var mots = [];

		$.each(criteres, function(index, critere) {
			var valeur = $('#champ_' + critere).val();
			if (valeur !== "") {
				args[critere] = valeur;
			}
		});

		args.mots = mots;
		args.lang = '#ENV{lang}';
		args.langue	= langue;
		args.recherche_avancee = [];

		if ($(this).is(':checked')) {
			args.recherche_avancee = [$(this).val()];
			remplace  = texte.replace(texte, texteOuvert);
		}
		else {
			remplace = texte.replace(texteOuvert, texte);
		}

		$('.editer_recherche_avancee .choix label').html(remplace);

		ajaxReload('recherche_criteres', {
			args : args,
			cache : false
		});

		event.stopPropagation();
		},true);
	});

</script>

