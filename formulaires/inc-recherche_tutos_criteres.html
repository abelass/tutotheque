#SET{mots,#ENV{mots}}
[(#REM) Les langues des tutos corespondants aux critères]
#SET{langues,#ARRAY}
<BOUCLE_tutos_langues(TUTOS) {si #GET{mots}|non}{fusion lang}>
	#SET{langues, #GET{langues}|array_merge{#ARRAY{#LANG,#LANG|traduire_nom_langue}}}
</BOUCLE_tutos_langues>
	<BOUCLE_tutos_langues_mots(TUTOS){mots 100% #GET{mots}}{fusion lang}>
		#SET{langues, #GET{langues}|array_merge{#ARRAY{#LANG,#LANG|traduire_nom_langue}}}
	</BOUCLE_tutos_langues_mots>
<//B_tutos_langues>

#SET{saisies,#ARRAY{
		0,#ARRAY{
			saisie,selection,
			options,#ARRAY{
				nom,langue,
				label,\<:tutotheque:champ_lang:\>,
				option_intro,\<:tutotheque:choix_tout:\>,
				data,#GET{langues}
				}
			}
		}
	}

[(#REM) Préparation des saisies]
[(#REM) les mots clés]
<BOUCLE_teste_ra(CONDITION){si #VAL{oui}|in_array{#ENV{recherche_avancee}}}>
<BOUCLE_criteres(DATA){source tableau,#ENV{_criteres}}>
	#SET{data,#ARRAY}
	#SET{request,#ENV{#VALEUR}}

	[(#REM) Enlève la valeur du champ concerné afin de ne pas l'autolimiter]
	#SET{mots,#GET{mots}|array_diff{#LISTE{#GET{request}}}}

	[(#REM) Ajouter aux options les mots qui donneront un résultat]
	<B_groupe>
	<BOUCLE_groupe(GROUPES_MOTS){id_groupe=#CLE}{par titre}>
	<B_mots>
		#SET{titre_groupe,#TITRE}
		<BOUCLE_mots(MOTS){id_groupe}{par titre}>
			<B_teste>
			<BOUCLE_teste(CONDITION){si #GET{mots}}>
				<B_tuto>
					#SET{data,#GET{data}|array_merge{#ARRAY{#TITRE,#ID_MOT}}}
				<BOUCLE_tuto(TUTOS){id_mot}{mots 100% #GET{mots}}{lang IN #ENV{langue, #ENV{langues_def}}}> </BOUCLE_tuto>
			</BOUCLE_teste>
				<B_tuto_alter>
					#SET{data,#GET{data}|array_merge{#ARRAY{#TITRE,#ID_MOT}}}
				<BOUCLE_tuto_alter(TUTOS){id_mot}{lang IN #ENV{langue, #ENV{langues_def}}}> </BOUCLE_tuto_alter>
			<//B_teste>
		</BOUCLE_mots>
	</BOUCLE_groupe>
	</B_groupe>


	[(#REM) Composition des saisies]
	#SET{data,#GET{data}|array_flip}
	#SET{saisies,#GET{saisies}|array_merge{
			#ARRAY{
				#COMPTEUR_BOUCLE,#ARRAY{
					saisie,selection,
					options,#ARRAY{
						nom,#VALEUR,
						label,#GET{titre_groupe},
						option_intro,\<:tutotheque:choix_tout:\>,
						data,#GET{data},
					},
				}
			}
		}
	}
</BOUCLE_criteres>
[(#REM) Génération de champs critères]
#GENERER_SAISIES{
	#ARRAY{
			0,#ARRAY{
				saisie,fieldset,
				options,#ARRAY{
					nom,recherche_avancee,
					label, \<:tutotheque:fieldset_recherche_avancee_label:\>,
				},
				saisies,#GET{saisies}
			}
		}
	}

<script type="text/javascript">
	$( document ).ready(function() {
	var criteres = [(#ENV{_criteres}|json_encode)]

	// Les arguments définits
	function parametres(critereChoisit, valeurChoisit) {
		var args = {
			_criteres: criteres,
		};
		var mots = [];
		$.each(criteres, function(index, critere) {
			var valeur = $('#champ_' + critere).val();
			if (critereChoisit !== undefined && critere == critereChoisit) {
				valeur = valeurChoisit;
				args[critere] = valeur;
			}
			else if (valeur !== "") {
				mots.push(valeur);
				args[critere] = valeur;
			}
		});
		args.langue = $('#champ_langue').val();
		args.mots = mots;
		return args;
	}

	$.each(criteres, function(key, critere) {
		var champ = document.querySelector('#champ_' + critere);

		champ.addEventListener('change', function(event) {
			argsMot = parametres(critere, $(this).val());

			ajaxReload('recherche_criteres', {
				args : argsMot,
				cache : false
			});
		event.stopPropagation();
		},true);
	});

	$('#champ_langue').on('change', function (e) {
		var args = parametres();
			ajaxReload('recherche_criteres', {
				args : args,
				cache : false
			})
	});
});
</script>
</BOUCLE_teste_ra>
<br class="hidden">
<//B_teste_ra>
