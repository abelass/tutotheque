#SET{saisies,#ARRAY}

[(#REM) Préparation des saisies]
<BOUCLE_criteres(DATA)
	{source tableau,#ENV{_criteres}}
	{si #VAL{oui}|in_array{#ENV{recherche_avancee}}}>
  #SET{mots,#ENV{mots}}
	#SET{data,#ARRAY}
	#SET{request,#ENV{#VALEUR}}

	[(#REM) Enlève la valeur du champ concerné afin de ne pas l'autolimiter]
	#SET{mots,#GET{mots}|array_diff{#LISTE{#GET{request}}}}

	[(#REM) Ajouter aux options les mots qui donneront un résultat]
	<BOUCLE_groupe(MOTS){id_groupe=#CLE}{par titre}>
		#SET{titre_groupe,#TYPE}
		<B_teste>
		<BOUCLE_teste(CONDITION){si #GET{mots}}>
			<B_tuto>
				#SET{data,#GET{data}|array_merge{#ARRAY{#TITRE,#ID_MOT}}}
			<BOUCLE_tuto(TUTOS){id_mot}{mots 100% #GET{mots}}> </BOUCLE_tuto>
		</BOUCLE_teste>
			<B_tuto_alter>
				#SET{data,#GET{data}|array_merge{#ARRAY{#TITRE,#ID_MOT}}}
			<BOUCLE_tuto_alter(TUTOS){id_mot}> </BOUCLE_tuto_alter>
		<//B_teste>
	</BOUCLE_groupe>

	[(#REM) Composition des saisies]
	#SET{data,#GET{data}|array_flip}
	#SET{saisies,#GET{saisies}|array_merge{
			#ARRAY{
				#COMPTEUR_BOUCLE,#ARRAY{
					saisie,selection,
					options,#ARRAY{
						nom,#VALEUR,
						label,#GET{titre_groupe},
						option_intro,\<:tutotheque:choix_tout:\>,
						data,#GET{data},
					},
				}
			}
		}
	}
</BOUCLE_criteres>

[(#REM) Génération de champs critères]
#GENERER_SAISIES{
	#ARRAY{
			0,#ARRAY{
				saisie,fieldset,
				options,#ARRAY{
					nom,recherche_avancee,
					label, \<:tutotheque:fieldset_recherche_avancee_label:\>,
				},
				saisies,#GET{saisies}
			}
		}
	}

<BOUCLE_teste_ra(CONDITION){si #VAL{oui}|in_array{#ENV{recherche_avancee}}}>
<script type="text/javascript">
$(function() {
	var criteres = [(#ENV{_criteres}|json_encode)]

	function parametres(critereChoisit, valeurChoisit) {
		// Les arguments définits
		var args = {
			_criteres: criteres,
		};

		var mots = [];
		$.each(criteres, function(index, critere) {
			var valeur = $('#champ_' + critere).val();
			if (critere == critereChoisit) {
				valeur = valeurChoisit;
				args[critere] = valeur;
			}
			else if (valeur !== "") {
				mots.push(valeur);
				args[critere] = valeur;
			}
		});

		args.mots = mots;

		return args;
	}

	$.each(criteres, function(key, critere) {

    var champ = document.querySelector('#champ_' + critere);
		champ.addEventListener('change', function(event) {
			args = parametres(critere, $(this).val());
			ajaxReload('recherche_mots', {
				args : args,
				cache : false
			});
		event.stopPropagation();
		},true);
	});
});
</script>
</BOUCLE_teste_ra>
